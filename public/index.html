<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silver Track Call Taxi - Invoice Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 900px;
        }
        .form-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            margin: 2rem 0;
        }
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }
        .form-section h5 {
            color: #667eea;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
        }
        .btn-secondary {
            background: #6c757d;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
        }
        .form-control {
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
        }
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        .taxi-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        .company-info {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <i class="fas fa-taxi taxi-icon"></i>
            <h1>üöñ Silver Track Call Taxi</h1>
            <p class="mb-0">Professional invoice generation for taxi services</p>
            
            <div class="company-info">
                <h6>Silver Track Call Taxi</h6>
                <p class="mb-1">GST: 33AEOFS0649R1Z9</p>
                <p class="mb-1">üìç No. 322-1 Auditors colony, Meyyanur Main Road, 5 roads, Salem - 636005, TamilNadu</p>
                <p class="mb-0">üìû +91-9786999777 | üìß silvercalltaxi@gmail.com</p>
            </div>
        </div>

        <div class="form-card">
            <form id="invoiceForm" method="POST" action="/generate-invoice">
                <!-- Customer Information -->
                <div class="form-section">
                    <h5><i class="fas fa-user me-2"></i>Customer Information</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="customerName" class="form-label">Customer Name *</label>
                            <input type="text" class="form-control" id="customerName" name="customerName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="customerPhone" class="form-label">Phone Number *</label>
                            <input type="tel" class="form-control" id="customerPhone" name="customerPhone" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="customerEmail" class="form-label">Email (Optional)</label>
                            <input type="email" class="form-control" id="customerEmail" name="customerEmail">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="customerGst" class="form-label">GST Number (Optional)</label>
                            <input type="text" class="form-control" id="customerGst" name="customerGst" placeholder="">
                        </div>
                        <div class="col-12 mb-3">
                            <label for="customerAddress" class="form-label">Customer Address (Optional)</label>
                            <textarea class="form-control" id="customerAddress" name="customerAddress" rows="2"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Trip Information -->
                <div class="form-section">
                    <h5><i class="fas fa-route me-2"></i>Trip Information</h5>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="pickupLocation" class="form-label">Pickup Location *</label>
                            <input type="text" class="form-control" id="pickupLocation" name="pickupLocation" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="dropLocation" class="form-label">Drop Location *</label>
                            <input type="text" class="form-control" id="dropLocation" name="dropLocation" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="pickupDate" class="form-label">Pickup Date *</label>
                            <input type="date" class="form-control" id="pickupDate" name="pickupDate" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="pickupTime" class="form-label">Pickup Time *</label>
                            <input type="time" class="form-control" id="pickupTime" name="pickupTime" required>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="dropDate" class="form-label">Drop Date</label>
                            <input type="date" class="form-control" id="dropDate" name="dropDate">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="dropTime" class="form-label">Drop Time</label>
                            <input type="time" class="form-control" id="dropTime" name="dropTime">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="distance" class="form-label">Distance (KM)</label>
                            <input type="number" step="0.1" class="form-control" id="distance" name="distance">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="duration" class="form-label">Trip Duration</label>
                            <input type="text" class="form-control" id="duration" name="duration" placeholder="e.g., 2h 30m">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="waitingTime" class="form-label">Waiting Time (Minutes)</label>
                            <input type="number" class="form-control" id="waitingTime" name="waitingTime" value="0">
                        </div>
                    </div>
                </div>

                <!-- Vehicle Information -->
                <div class="form-section">
                    <h5><i class="fas fa-car me-2"></i>Vehicle Information</h5>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="vehicleType" class="form-label">Vehicle Type *</label>
                            <select class="form-control" id="vehicleType" name="vehicleType" required>
                                <option value="">Select Vehicle Type</option>
                                <option value="Hatchback">Hatchback</option>
                                <option value="Sedan">Sedan</option>
                                <option value="SUV">SUV</option>
                                <option value="Premium">Premium</option>
                                <option value="Auto Rickshaw">Auto Rickshaw</option>
                                <option value="Tempo Traveller">Tempo Traveller</option>
                            </select>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="vehicleNumber" class="form-label">Vehicle Number</label>
                            <input type="text" class="form-control" id="vehicleNumber" name="vehicleNumber" placeholder="TN 28 AB 1234">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="driverName" class="form-label">Driver Name</label>
                            <input type="text" class="form-control" id="driverName" name="driverName">
                        </div>
                    </div>
                </div>

                <!-- Fare Information -->
                <div class="form-section">
                    <h5><i class="fas fa-rupee-sign me-2"></i>Fare Information</h5>
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="baseFare" class="form-label">Base Fare (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="baseFare" name="baseFare" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="distanceRate" class="form-label">Rate per KM (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="distanceRate" name="distanceRate" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="timeRate" class="form-label">Rate per Minute (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="timeRate" name="timeRate" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="tolls" class="form-label">Tolls (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="tolls" name="tolls" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="parking" class="form-label">Parking (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="parking" name="parking" value="0">
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="extraCharges" class="form-label">Extra Charges (‚Çπ)</label>
                            <input type="number" step="0.01" class="form-control" id="extraCharges" name="extraCharges" value="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="paymentMethod" class="form-label">Payment Method</label>
                            <select class="form-control" id="paymentMethod" name="paymentMethod">
                                <option value="Cash">Cash</option>
                                <option value="UPI">UPI</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Debit Card">Debit Card</option>
                                <option value="Net Banking">Net Banking</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Additional Information -->
                <div class="form-section">
                    <h5><i class="fas fa-sticky-note me-2"></i>Additional Information</h5>
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label for="notes" class="form-label">Notes/Comments</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Any additional notes or special instructions..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center">
                    <button type="button" class="btn btn-secondary me-3" onclick="previewInvoice()">
                        <i class="fas fa-eye me-2"></i>Preview Invoice
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-download me-2"></i>Generate PDF Invoice
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Set default date to today
        document.getElementById('pickupDate').value = new Date().toISOString().split('T')[0];
        
        // Auto-calculate duration when drop time is entered
        function calculateDuration() {
            const pickupTime = document.getElementById('pickupTime').value;
            const dropTime = document.getElementById('dropTime').value;
            
            if (pickupTime && dropTime) {
                const pickup = new Date(`2000-01-01T${pickupTime}:00`);
                const drop = new Date(`2000-01-01T${dropTime}:00`);
                
                let diffMs = drop - pickup;
                if (diffMs < 0) {
                    diffMs += 24 * 60 * 60 * 1000; // Add 24 hours for next day
                }
                
                const hours = Math.floor(diffMs / (1000 * 60 * 60));
                const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
                
                document.getElementById('duration').value = `${hours}h ${minutes}m`;
            }
        }
        
        document.getElementById('pickupTime').addEventListener('change', calculateDuration);
        document.getElementById('dropTime').addEventListener('change', calculateDuration);
        
        // Auto-set drop date same as pickup date
        document.getElementById('pickupDate').addEventListener('change', function() {
            const dropDate = document.getElementById('dropDate');
            if (!dropDate.value) {
                dropDate.value = this.value;
            }
        });
        
        function previewInvoice() {
            const form = document.getElementById('invoiceForm');
            const formData = new FormData(form);
            
            // Validate required fields
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            // Convert to JSON
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            // Send to preview endpoint
            fetch('/preview-invoice', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.text())
            .then(html => {
                const newWindow = window.open();
                newWindow.document.write(html);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error previewing invoice');
            });
        }
        
        // Form submission for PDF generation
        document.getElementById('invoiceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Generating...';
            submitBtn.disabled = true;
            
            fetch('/generate-invoice', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.blob())
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Invoice-${Date.now()}.pdf`;
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error generating invoice');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
    </script>
</body>
</html>
